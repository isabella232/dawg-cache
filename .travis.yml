language: cpp

sudo: false

addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
      - llvm-toolchain-precise-3.5
    packages:
      - clang-3.5

matrix:
  include:
     # Linux
     - os: linux
       compiler: clang
       env: NODE_VERSION="0.10.38" PUBLISHABLE=true
     - os: linux
       compiler: clang
       env: NODE_VERSION="4.4.2" PUBLISHABLE=true
     # Debug build (only for testing)
     - os: linux
       compiler: clang
       env: NODE_VERSION="4.4.2" NPM_FLAGS="--debug"
     # OS X
     - os: osx
       compiler: clang
       env: NODE_VERSION="0.10.38" PUBLISHABLE=true
     - os: osx
       compiler: clang
       env: NODE_VERSION="4.4.2" PUBLISHABLE=true

env:
  global:
    - secure: "RMUZUUP2xBRULwEZ5ykYIzo9drjjzuV1p1Pnrw06+bDzCgfL9djgrex1lWg5pNP5BR1JlTxsnniroSZg6WSkShXQwIZ3407ddhXhRoxumc/uD7gzdv1ogW8OgIZfUX1WOW239cOHBUuLLWZyN4Fhsu19HnLx9gKajZTlnrGGkhUvkKbROp9SCKa2hVhNP1y7zsuGM+zQMOPVKcg0lWj9Bs6UAOafzahNc6UQVw7S7+7bp5CWRw8mpvhAMduYwQQCNnZiU1rkxQKJ7TyXgeYRbS5EgkZpw476inhUKFXl6v4XYqSyIoJ6oPCy/1qpzM/W6EtcMNJboris3/No56ERj6afJvlcVs95R/aRqAe/PSyyK+sPmKicBFkWfWPyU+y+FmRQ5JBpIaFw/uL6KLVYCA4riC666+j/4XsN/YGfxwyUPB3FtT7i57u9ivj9QLtoJDYGaQIQwXVuG9LnkGuGutNKT5p+oX+QDFW82jmpwcXqZ03sH9Ty4P+UsV15K97b6Q+rNeMbIpharlv+uYQLetOCN4FlEWAM/Bxl+IdwL38pUD/50i4enGof9tJeNIh5sV35pG7w7AG5jnY3rwROI1hXVlVtNsi+saQ5IR1oty23GuZNb+wzy5bp84FA9BJg4Sgsoacu2jhP5VLtM0AYdy8SCKbjTZrosMmgloOnXdY="
    - secure: "yq6M4D8J4lUBb/SHa/4qO+dn9cXVuUoUo+UWgvsypBiwSi1+89YADO8QK9UMQgF+uqOxoWSd9S4QrV14VBWmxLCHjT71OuyIv3ZqTMvWAFLR5e2RYsydPdS9RXVe/XTKkBUffsQXmG4tFXOwz/mdMxarjcPwerOgeFb5RFeKOCguJ607dtlAnDSTtS3Z6sPIu48kknDmVTpbNKZMHgyUg4Y7SrJ8zRK4tYbjeXo6XvqK5HZ7SW117pNKx33NxcbeudgHcWrIrAaquXEA/Ep/7ILC6Q4khblSNz7I7Z14Tw8R4peT6aQ5CKx/PRYyEp1vnaJjx2eVQIUq9JRlARE1Pk0B2YUF2kSYf4kQcj/3swtniIkUKKdZCqmZzc/ZrcYGfLoqJn2XhuDYjwvRgQBUvCZY42C4JLJ0jjfJVVkiFooTmADtpwDeWtMDBOwbM9uJJd7rbxQnYvCYQxIG4bYnJQBNvBCmeOgP4VFmmPxIP3pKnEivB03ZEXEpp4qBybrBxDsR3nQVcUqeaFyVtEq2B6NDTzK9F9JOX3Tve9J068F0epsiWWI2FoBJUPngY/E+uSoUkr0VISi9Oh+yZ6pZlE2PLsxKoB2fVnX6xuGbtS86tG6kFbBTbfEUiZbIIYpNQyoWLi9Fkt3pa1md+RxJvZSqqMNMZAlR4dLcMxrmWho="

before_install:
  - if [[ $(uname -s) == 'Linux' ]]; then
      export CXX="clang++-3.5";
      export CC="clang-3.5";
    fi;
  - rm -rf ~/.nvm/ && git clone --depth 1 https://github.com/creationix/nvm.git ~/.nvm
  - source ~/.nvm/nvm.sh
  - nvm install $NODE_VERSION
  - nvm use $NODE_VERSION

install:
  - npm install --build-from-source --clang=1 ${NPM_FLAGS:-}

script:
  - npm test

after_success:
  - if [[ ${PUBLISHABLE:-} == true ]]; then ./test/travis-publish.sh; fi
